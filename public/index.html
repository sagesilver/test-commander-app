<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon-32x32.png" type="image/png" />
    <link rel="shortcut icon" href="%PUBLIC_URL%/favicon-32x32.png" type="image/png" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Test Commander - Modern test case and defect management platform"
    />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <title>Test Commander</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <!-- FirebaseUI -->
    <script src="https://www.gstatic.com/firebasejs/ui/6.0.1/firebase-ui-auth.js"></script>
    <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/6.0.1/firebase-ui-auth.css" />
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    
    <!-- Firebase Configuration -->
    <script>
      // Firebase configuration
      const firebaseConfig = {
        apiKey: "%REACT_APP_FIREBASE_API_KEY%",
        authDomain: "%REACT_APP_FIREBASE_AUTH_DOMAIN%",
        projectId: "%REACT_APP_FIREBASE_PROJECT_ID%",
        storageBucket: "%REACT_APP_FIREBASE_STORAGE_BUCKET%",
        messagingSenderId: "%REACT_APP_FIREBASE_MESSAGING_SENDER_ID%",
        appId: "%REACT_APP_FIREBASE_APP_ID%",
        measurementId: "%REACT_APP_FIREBASE_MEASUREMENT_ID%"
      };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);

      // Listen for auth state changes
      firebase.auth().onAuthStateChanged(function (user) {
        if (user) {
          // User is signed in
          console.log(`Signed in as ${user.displayName} (${user.email})`);
          user.getIdToken().then(function (token) {
            // Add the token to the browser's cookies. The server will then be
            // able to verify the token against the API.
            // SECURITY NOTE: As cookies can easily be modified, only put the
            // token (which is verified server-side) in a cookie; do not add other
            // user information.
            document.cookie = "token=" + token;
          });
        } else {
          // User is signed out.
          // Clear the token cookie.
          document.cookie = "token=";
        }
      }, function (error) {
        console.log(error);
        alert('Unable to log in: ' + error)
      });

      // Setup function for creating app admin record
      window.setupTestCommanderAppAdmin = async function() {
        try {
          const user = firebase.auth().currentUser;
          if (!user) {
            alert('Please sign in first');
            return;
          }

          const db = firebase.firestore();
          
          // Create app admin record
          const appAdminData = {
            appAdminId: user.uid,
            email: user.email,
            name: user.displayName || "Test Commander Super User",
            role: "APP_ADMIN",
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            lastLoginAt: firebase.firestore.FieldValue.serverTimestamp()
          };

          await db.collection('appAdmins').doc(user.email).set(appAdminData);
          console.log('App admin record created successfully');
          alert('App admin record created successfully!');
          
          // Reload the page to update authentication state
          window.location.reload();
        } catch (error) {
          console.error('Error creating app admin record:', error);
          alert('Error creating app admin record: ' + error.message);
        }
      };
    </script>
  </body>
</html> 